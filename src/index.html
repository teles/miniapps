<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title x-ref="title">üçÖ Pomodo tracker</title>
  </head>
  <body 
    x-data="pomodoro" 
    class="w-full flex justify-center bg-gradient-to-t from-blue-500 to-indigo-500 min-h-screen flex justify-items-center items-center min-w-full"
    x-cloak>
    <main class="h-100 w-full flex-col justify-center font-sans p-8 bg-white shadow rounded m-4" style="max-width:450px;">
      <header class="mb-4">
        <h1 class="title-font sm:text-4xl text-3xl mb-4 font-medium text-gray-900">üçÖ Pomodoro tracker</h1>
      </header>
      <div>
        <header class="text-sm font-medium text-center text-gray-500 border-b border-gray-200">
          <ul class="flex flex-wrap -mb-px">
            <template x-for="tab in tabs.items">
              <li class="mr-2 flex" :class="tab.extra_class">
                <span 
                  class="inline-block p-4 border-b-2 border-transparent rounded-t-lg cursor-pointer" 
                  :class="tabs.active === tab.id ? 'text-blue-600 border-blue-600 active' : 'hover:text-gray-600 hover:border-gray-300'" 
                  @click="tabs.active = tab.id"
                  >
                  <template x-if="tab.label">
                    <span x-text="tab.label"></span>
                  </template>
                  <template x-if="tab.icon">
                    <svg class="fill-current text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                      <path :d="icons[tab.icon]" />
                    </svg>
                  </template>
                  <template x-if="tab.is_blinking">
                    <span class="animate-ping inline-flex rounded-full bg-yellow-400 opacity-75 h-1.5 w-1.5"></span>
                  </template>
                </span>
              </li>
            </template>
          </ul>
        </header>
        <section x-show="tabs.active === 'running'" style="min-height: 300px;">
          <div class="flex my-4 bg-white">
            <input 
              class="shadow appearance-none border rounded w-full py-2 px-3 mr-4 text-grey-darker" 
              type="text" 
              x-model="new_pomodoro_text" 
              x-bind:placeholder="new_pomodoro_placeholder" 
              @keyup.enter="add()">
            <button 
              class="rounded-md px-3 py-2 shadow bg-indigo-500 text-white transition-all" 
              @click="add()" 
              :disabled="new_pomodoro_text.length === 0" 
              :class="new_pomodoro_text.length === 0 ? 'opacity-50' : ''"> 
              Add 
            </button>
          </div>
          <div class="flex flex-col mt-4 overflow-auto" style="height:250px; max-height:250px;">
            <template x-for="pomodoro in pomodoros">
              <div class="mb-2" :class="pomodoro.state === 'running' && configs.running_first ? 'order-1' : 'order-2' ">
              <div class="flex items-center pl-2 border rounded mt-2 transition-all" 
                :class="{
                    'running': 'bg-yellow-50 border-yellow-200 text-yellow-500', 
                    'paused': 'bg-gray-50 border-gray-200 text-gray-500', 
                    'finished': 'bg-blue-50 border-blue-200 text-blue-500' 
                  }[pomodoro.state]"
                >
                <p 
                  x-show="!pomodoro.is_editing" 
                  class="w-full py-2 m-2 text-sm font-medium" 
                  @click="pomodoro.is_editing = true" 
                  x-text="pomodoro.text"></p>
                <textarea 
                  x-show="pomodoro.is_editing" 
                  type="text" 
                  class="w-full py-2 m-2 text-sm font-medium bg-transparent overflow-hidden outline-none" 
                  @click.away="pomodoro.is_editing = false" 
                  @keyup.enter="pomodoro.is_editing = false" 
                  maxlength="80" 
                  x-model="pomodoro.text">
                </textarea>
                <div class="inline-flex" role="group">
                  <button 
                    type="button" 
                    class="my-1 px-3 py-2 bg-gray-500 text-white cursor-pointer shadow rounded-l-md shadow-sm" 
                    @click="pomodoro.state === 'running' ? pause(pomodoro) : run(pomodoro)">
                    <svg class="fill-current text-white text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                      <path :d="icons[{
                        'running': 'pause',
                        'paused': 'play',
                        'finished': 'pause'
                      }[pomodoro.state]]" 
                      />
                    </svg>
                  </button>
                  <button 
                    style="min-width:70px;" 
                    type="button" 
                    class="my-1 px-3 py-2 bg-gray-400 text-gray-100 shadow flex rounded-r-md shadow-sm" 
                    x-init="window.setInterval(() => { 
                      countdown(pomodoro);
                    }, 1_000)">
                    <span x-text="Math.floor(pomodoro.countdown / 60)"></span>
                    <span>:</span>
                    <span x-text="Math.floor(pomodoro.countdown % 60) < 10 ? '0' + Math.floor(pomodoro.countdown % 60) : Math.floor(pomodoro.countdown % 60)">
                    </span>
                  </button>
                </div>
                <button 
                  type="button" 
                  class="m-1 rounded-md px-3 py-2 text-white shadow flex" 
                  :class="{
                    'running': 'cursor-default bg-red-500 events-none opacity-50',
                    'paused': 'cursor-pointer bg-red-500',
                    'finished': 'cursor-pointer bg-green-500'
                  }[pomodoro.state]"
                  @click="pomodoro.state === 'finished' ? save(pomodoro) : remove(pomodoro)">
                  <svg class="fill-current text-white text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                    <path :d="pomodoro.state === 'finished' ? icons.check : icons.trash" />
                  </svg>
                </button>
              </div>
              <div class="w-full bg-gray-100 h-1 mt-1">
                <span 
                  :class="{
                    'running': 'bg-yellow-500',
                    'paused': 'bg-gray-500',
                    'finished': 'bg-blue-500'
                  }[pomodoro.state]"
                  class="h-1 block transition-all" 
                  :style="{'width': 100 - (pomodoro.countdown / (60 * 25) * 100) + '%'}">
                </span>
              </div>                
              </div>              
            </template>
          </div>
        </section>
        <section x-show="tabs.active === 'archived'" style="min-height: 300px;">        
          <p x-text="JSON.stringify(pomodoros.filter(pomodoro => pomodoro.state === 'archived'))"></p>
        </section>
        <section x-show="tabs.active === 'configs'" style="min-height: 300px;" class="pt-4">
          <h2 class="text-lg mb-2 text-gray-600 font-bold">Preferences</h2>
          <ul>

          </ul>
          <label class="w-full block text-gray-500">
            <input class="mr-2 leading-tight" type="checkbox" x-model="configs.running_first">
            <span class="text-sm">
              Always display running pomodoro at the top
            </span>
          </label>
          <label class="w-full block text-gray-500">
            <input class="mr-2 leading-tight" type="checkbox" x-model="configs.start_anytime">
            <span class="text-sm">
              Can start new pomodoro without finishing the current one
            </span>
          </label>                    
        </section>
      </div>
    </main>
  </body>
</html>