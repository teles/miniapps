<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçÖ Daily Pomodoros</title>
  </head>
  <style>
    [x-cloak] { display: none !important; }
  </style>
  <body 
    x-data="pomodoro" 
    class="w-full flex justify-center bg-gradient-to-t from-blue-500 to-indigo-500 min-h-screen flex justify-items-center items-center min-w-full"
    x-cloak>
    <main class="h-100 w-full flex-col justify-center font-sans p-8 bg-white shadow rounded m-4 max-w-[450px] h-[500px]">
      <header class="mb-4">
        <h1 class="title-font sm:text-4xl text-3xl mb-4 font-medium text-gray-900 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="30px" width="30px" version="1.1" id="Capa_1" viewBox="0 0 17.208 17.208" xml:space="preserve" class="mr-2">
            <path style="fill: #ef4444;" d="M12.889,2.805l-0.324,0.136c-0.497,0.208-0.791,0.479-1.044,0.753    c0.232,0.108,0.455,0.246,0.667,0.411c0.473,0.385,0.792,0.801,1.042,1.353l0.376,0.825l-0.9-0.111    c-0.645-0.078-1.077,0.066-1.496,0.205c-0.171,0.058-0.346,0.116-0.529,0.156c0.012,0.076,0.021,0.153,0.027,0.229    c0.04,0.456-0.021,0.919-0.179,1.376c-0.211,0.573-0.499,1.009-0.94,1.425L9.292,9.842L8.955,9.614    C8.454,9.273,8.099,8.888,7.804,8.365C7.607,7.997,7.48,7.621,7.426,7.235c-0.206,0.036-0.41,0.043-0.61,0.051    C6.376,7.303,5.92,7.32,5.345,7.622L4.542,8.045L4.601,7.14c0.039-0.604,0.19-1.105,0.492-1.625    c0.183-0.302,0.398-0.564,0.646-0.784c-0.057-0.05-0.113-0.102-0.168-0.153c-0.324-0.299-0.659-0.609-1.28-0.802l-0.867-0.27    l0.531-0.467C0.957,3.942,0,6.579,0,9.539c0,4.146,3.852,7.507,8.604,7.507c4.751,0,8.604-3.361,8.604-7.507    C17.208,6.483,16.105,3.58,12.889,2.805z"></path>
            <path style="fill: #22c55d;" d="M6.333,4.893C6.018,5.112,5.748,5.398,5.531,5.757c-0.213,0.366-0.385,0.79-0.424,1.402    C6.38,6.49,7.173,7.005,7.916,6.495C7.9,6.655,7.896,6.813,7.91,6.972c0.027,0.383,0.137,0.76,0.336,1.13    C8.454,8.471,8.731,8.834,9.24,9.179c0.446-0.421,0.662-0.824,0.809-1.222c0.138-0.396,0.187-0.785,0.152-1.168    c-0.021-0.249-0.078-0.495-0.167-0.738c0.805,0.116,1.377-0.563,2.733-0.396c-0.254-0.559-0.565-0.895-0.893-1.162    c-0.33-0.259-0.683-0.43-1.056-0.523c-0.077-0.02-0.153-0.034-0.232-0.046c0.47-0.394,0.772-1.041,1.783-1.463    c-0.499-0.359-0.936-0.497-1.353-0.565c-0.416-0.061-0.807-0.035-1.177,0.07c-0.37,0.102-0.72,0.281-1.046,0.546    C8.668,2.618,8.547,2.74,8.43,2.874C7.981,1.423,7.451,0.265,7.403,0.162L7.056,0.323c0.011,0.025,0.565,1.231,1.023,2.724    c-0.024-0.022-0.05-0.043-0.076-0.061C7.654,2.753,7.289,2.608,6.91,2.542C6.533,2.474,6.139,2.485,5.732,2.585    C5.323,2.694,4.902,2.872,4.44,3.277c1.225,0.381,1.515,1.157,2.19,1.437C6.528,4.769,6.428,4.827,6.333,4.893z M8.879,4.154    c0.005,0,0.01,0.003,0.014,0.004C8.875,4.166,8.856,4.176,8.838,4.185C8.851,4.175,8.865,4.165,8.879,4.154z"></path>
        </svg>          
        <p>Daily Pomodoros</p>
        </h1>
      </header>
      <div>
        <header class="text-sm font-medium text-center text-gray-500 border-b border-gray-200">
          <ul class="flex flex-wrap -mb-px">
            <template x-for="tab in tabs.items">
              <li class="mr-2 flex" :class="tab.extra_class">
                <span 
                  class="inline-block p-4 border-b-2 rounded-t-lg cursor-pointer" 
                  :class="tabs.active === tab.id 
                    ? 'text-blue-600 border-blue-600 active' 
                    : 'border-transparent hover:text-gray-600 hover:border-gray-300'" 
                  @click="tabs.active = tab.id"
                  >
                  <template x-if="tab.label">
                    <span x-text="tab.label"></span>
                  </template>
                  <template x-if="tab.icon">
                    <svg class="fill-current text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                      <path :d="icons[tab.icon]" />
                    </svg>
                  </template>
                  <template x-if="tab.is_blinking">
                    <span class="animate-ping inline-flex rounded-full bg-yellow-400 opacity-75 h-1.5 w-1.5"></span>
                  </template>
                </span>
              </li>
            </template>
          </ul>
        </header>
        <section x-show="tabs.active === 'home'" class="min-h-[320px]">
          <div class="flex my-4 bg-white">
            <input 
              class="shadow appearance-none border rounded w-full py-2 px-3 mr-4 text-grey-darker" 
              type="text" 
              x-model="new_pomodoro_text" 
              x-bind:placeholder="new_pomodoro_placeholder" 
              @keyup.enter="add()">
            <button 
              class="rounded-md px-3 py-2 shadow bg-indigo-500 text-white transition-all" 
              @click="add()" 
              :disabled="new_pomodoro_text.length === 0" 
              :class="new_pomodoro_text.length === 0 ? 'opacity-50' : ''"> 
              Add 
            </button>
          </div>
          <div class="flex flex-col mt-2 overflow-auto h-[250px] max-h-[250px]">
            <template x-for="pomodoro in pomodoros">
              <article 
                class="mb-2" 
                :class="stages_map[pomodoro.stage].state === 'running' && configs.running_first ? 'order-1' : 'order-2' ">
                <div 
                  class="flex items-center pl-2 border rounded mt-2 transition-all" 
                  :class="stages_map[pomodoro.stage].styles.base">
                  <p 
                    x-show="!pomodoro.is_editing" 
                    class="w-full py-2 m-2 text-sm font-medium" 
                    @click="pomodoro.is_editing = true" 
                    x-text="pomodoro.text">
                  </p>
                  <textarea 
                    x-show="pomodoro.is_editing" 
                    type="text" 
                    class="w-full py-2 m-2 text-sm font-medium bg-transparent overflow-hidden outline-none" 
                    @click.away="pomodoro.is_editing = false" 
                    @keyup.enter="pomodoro.is_editing = false" 
                    maxlength="80" 
                    x-model="pomodoro.text">
                  </textarea>   
                  <div class="inline-flex pr-2">
                    <button 
                      class="my-1 px-3 py-2 text-white cursor-pointer shadow rounded-l-md shadow-sm" 
                      @click="handle_timer_click(pomodoro)"
                      :class="stages_map[pomodoro.stage].styles.timer_action">
                      <svg class="fill-current text-white text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                        <path :d="icons[stages_map[pomodoro.stage].timer_icon]" />
                      </svg>
                    </button>  
                    <div 
                      class="my-1 px-3 py-2 shadow flex rounded-r-md shadow-sm min-w-[70px]"
                      :class="stages_map[pomodoro.stage].styles.timer"
                      x-init="window.setInterval(() => { countdown(pomodoro) }, 1_000)">
                      <span x-text="Math.floor(pomodoro[stages_map[pomodoro.stage].timer_property] / 60)"></span>
                      <span>:</span>
                      <span x-text="Math.floor(pomodoro[stages_map[pomodoro.stage].timer_property] % 60) < 10 ? '0' + Math.floor(pomodoro[stages_map[pomodoro.stage].timer_property] % 60) : Math.floor(pomodoro[stages_map[pomodoro.stage].timer_property] % 60)"></span>
                    </div>                                      
                  </div>
                  <button 
                    class="m-1 rounded-md px-3 py-2 text-white shadow flex"
                    :class="stages_map[pomodoro.stage].styles.button"
                    @click="handle_button_timer_click(pomodoro, stages_map[pomodoro.stage].button)">
                    <svg class="fill-current text-white text-lg w-4" viewBox="0 0 512 512" width="24px" height="24px">
                      <path :d="icons[stages_map[pomodoro.stage].button_icon]" />
                    </svg>                    
                  </button>                   
                </div>
                <div 
                  class="w-full h-1 mt-1"
                  :class="stages_map[pomodoro.stage].styles.progress_bg">
                  <span                     
                    :class="stages_map[pomodoro.stage].styles.progress_bar"
                    class="h-1 block transition-all" 
                    :style="{'width': 100 - (pomodoro[stages_map[pomodoro.stage].timer_property] / stages_map[pomodoro.stage].timer_initial * 100) + '%'}">
                  </span>
              </div>                 
              </article>
            </template>
          </div>
        </section>
        <section x-show="tabs.active === 'archived'" class="min-h-[320px]">        
          <p x-text="JSON.stringify(pomodoros.filter(pomodoro => pomodoro.stage === 'archived'))"></p>
        </section>
        <section x-show="tabs.active === 'configs'" class="pt-4 min-h-[320px]">
          <h2 class="text-lg mb-2 text-gray-600 font-bold">Preferences</h2>
          <label class="w-full block text-gray-500">
            <input class="mr-2 leading-tight" type="checkbox" x-model="configs.running_first">
            <span class="text-sm">
              Always display running pomodoro at the top
            </span>
          </label>
          <label class="w-full block text-gray-500">
            <input class="mr-2 leading-tight" type="checkbox" x-model="configs.start_anytime">
            <span class="text-sm">
              Can start new pomodoro without finishing the current one
            </span>
          </label>                    
        </section>
      </div>
    </main>
  </body>
</html>